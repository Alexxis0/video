<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Formulaire Nexmod ‚Äì Plein √©cran</title>
    <style>
        /* Couleurs Nexmod */
        :root {
            --bleu-nuit: #130c42;
            --bleu-electrique: white;
            --rose-violet: #e149ed;
            --blanc: #1b1b1b;
        }

        /* Supprime le scroll de page, le formulaire est en plein √©cran */
        html,
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: "Poppins", sans-serif;
        }

        /* Conteneur principal en plein √©cran */
        .formulaire-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            overflow: hidden;
            z-index: 9999;
            background-color: var(--bleu-nuit);
        }

        /* Partie vid√©o */
        .video-wrapper {
            width: 50%;
            height: 100%;
            position: relative;
            background-color: #000;
            overflow: hidden;
            cursor: pointer;
        }

        .video-seekbar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            z-index: 3;
        }

        .video-seekbar-fill {
            height: 100%;
            width: 0%;
            background-color: var(--rose-violet);
            transition: width 0.1s linear;
        }

        .video-wrapper .video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.4s ease;
            cursor: pointer;
            pointer-events: none;
        }

        .video-wrapper .video.active {
            opacity: 1;
            pointer-events: auto;
        }

        .video-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 80px;
            height: 80px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: auto;
            z-index: 2;
            transition: background-color 0.3s ease;
        }


        .video-overlay img {
            width: 48px;
            height: 48px;
        }

        .video-overlay:hover {
            background-color: rgba(255, 255, 255, 0.4);
        }

        /* Partie formulaire */
        .formulaire-questions {
            flex: 1;
            background-color: var(--bleu-electrique);
            position: relative;
            padding: 60px 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .step {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .step-title {
            width: 100%;
            font-size: 26px;
            font-weight: bold;
            color: var(--blanc);
            margin-bottom: 20px;
            text-align: left;
        }

        /* Agrandissement sp√©cifique pour certaines √©tapes */
        #step-3 textarea,
        #step-5 textarea,
        #step-7 textarea,
        #step-8 textarea,
        #step-9 textarea,
        #step-10 textarea {
            min-height: 200px;
        }

        .step textarea,
        .step input[type="number"] {
            width: 95%;
            padding: 20px;
            font-size: 24px;
            border: none;
            background: #f8f8f8;
            outline: none;
            color: --blanc;
            border-radius: 8px;
            margin-bottom: 60px;
            resize: none;
        }

        .step textarea::placeholder,
        .step input::placeholder {
            color: #808080;
            font-style: italic;
            font-size: 22px;
        }

        .input-field {
            width: 95%;
            padding: 20px;
            font-size: 24px;
            border: none;
            outline: none;
            background: #f8f8f8;
            color: --blanc;
            border-radius: 8px;
            pointer-events: initial;
            margin-bottom: 40px;
        }

        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.5);
            font-style: italic;
            font-size: 22px;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            width: 95%;
            margin-bottom: 20px;
        }

        .checkbox-group input[type="checkbox"] {
            display: none;
        }

        .checkbox-group label {
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            padding: 16px 24px;
            font-size: 20px;
            color: --blanc;
            transition: all 0.3s ease;
        }

        .checkbox-group label:has(input[type="checkbox"]:checked) {
            background-color: #f8f8f8;
            border-color: var(--rose-violet);
            color: var(--blanc);
        }

        .checkbox-group label:hover {
            border-color: var(--rose-violet);
        }

        /* Bouton suivant */
        .form-btn {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 999px;
            background-color: var(--bleu-nuit);
            cursor: not-allowed;
            transition: transform 0.3s ease, background-color 0.3s ease;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .form-btn.active {
            background-color: var(--rose-violet);
            cursor: pointer;
        }

        .form-btn.active:hover,
        .form-btn.active:active {
            transform: scale(1.1);
        }

        .arrow-icon {
            width: 26px;
            height: 26px;
            filter: brightness(0) invert(1);
        }

        .form-btn.active .arrow-icon {
            filter: none;
        }

        /* Animations fade */
        .fade-out {
            animation: fadeOut 0.4s forwards;
        }

        .fade-in {
            animation: fadeIn 0.4s forwards;
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }

            to {
                opacity: 0;
                transform: translateX(-40px);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateX(40px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Message final */
        .message-final-text {
            color: white;
            font-size: 22px;
            text-align: center;
            margin-top: 20px;
        }

        input[type="file"] {
            width: 95%;
            max-width: 100%;
            padding: 12px;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            border-radius: 8px;
            margin-bottom: 40px;
            font-size: 18px;
        }

        /* Progress bar container */
        .progress-container-devis {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 10px;
            background-color: rgba(255, 255, 255, 0.2);
            z-index: 5;
        }

        .progress-bar-devis {
            height: 100%;
            width: 0%;
            background-color: var(--rose-violet);
            transition: width 0.4s ease;
        }

        /* Responsive */
        @media screen and (max-width: 1024px) {

            /* Afficher la vid√©o en plein √©cran */
            .video-wrapper {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: block;
                z-index: 1;
            }

            .video-overlay {
                display: flex;
            }

            .video-seekbar {
                display: block;
            }

            html,
            body {
                overflow-x: hidden;
            }

            .formulaire-container {
                flex-direction: column;
                width: 100%;
                height: 100dvh;
                overflow-x: hidden;
                overflow-y: auto;
            }

            .formulaire-questions {
                position: absolute;
                bottom: 0;
                left: 50%;
                transform: translateX(-50%);
                width: 92%;
                background-color: transparent;
                z-index: 2;
                padding: 60px 10%;
                height: auto;
                max-width: 100%;
            }

            .step-title {
                font-size: 22px;
            }

            .step textarea,
            .step input,
            .input-field {
                font-size: 25px;
            }

            .input-field {
                border-radius: 11px;
                margin: 0px;
                padding: 20px;
                background: rgba(255, 255, 255, 0.6);
            }

            .step textarea::placeholder,
            .step input::placeholder,
            .input-field::placeholder {
                font-size: 16px;
            }

            .step {
                position: relative;
            }

            .form-btn {
                position: absolute;
                bottom: 43px;
                right: 10%;
                transform: translateY(-50%);
                width: 52px;
                height: 52px;
                z-index: 1000;
                border-radius: 50%;
            }

            .arrow-icon {
                width: 22px;
                height: 22px;
            }
        }
    </style>
</head>

<body>
    <!-- Conteneur principal du formulaire -->
    <div id="form-screen" class="formulaire-container">
        <!-- Barre de progression -->
        <div class="progress-container-devis">
            <div class="progress-bar-devis" id="progress-bar-devis"></div>
        </div>

        <!-- Partie vid√©o -->
        <div class="video-wrapper">
            <div class="video-overlay" id="play-button">
                <img src="https://cdn.prod.website-files.com/67d404ef725b4244f4b32ad1/6804f356d8d2a2893d47373c_play-icon.svg"
                    alt="Lire la vid√©o" />
            </div>
            <div class="video-seekbar" id="video-seekbar">
                <div class="video-seekbar-fill" id="video-seekbar-fill"></div>
            </div>
        </div>

        <!-- Formulaire -->
        <form class="formulaire-questions" id="mon-formulaire"
            action="https://hook.eu1.make.com/d41zmgpinni4novk1wrtqkpmgufbxxtg" method="POST">
            <!-- √âtapes (gard√©es telles quelles) -->
            <!-- √âtape 1 -->
            <!-- Formulaire HTML Nexmod complet avec toutes les √©tapes √† jour -->
            <!-- Chaque √©tape correspond √† une seule question pour une exp√©rience fluide -->

            <!-- √âtape 1 -->
            <div class="step" id="step-1">
                <h2 class="step-title">Quel est ton pr√©nom et ton nom ?</h2>
                <input type="text" name="nom_prenom" class="input-field" placeholder="Pr√©nom & nom">
            </div>

            <!-- √âtape 2 -->
            <div class="step" id="step-2" style="display: none;">
                <h2 class="step-title">Quelle est ton adresse e-mail ?</h2>
                <input type="email" name="email" class="input-field" placeholder="Ton e-mail">
            </div>

            <!-- √âtape 3 -->
            <div class="step" id="step-3" style="display: none;">
                <h2 class="step-title">Quel est le nom de ton entreprise ?</h2>
                <input type="text" name="nom_entreprise" class="input-field" placeholder="Nom de l'entreprise">
            </div>

            <!-- √âtape 4 -->
            <div class="step" id="step-4" style="display: none;">
                <h2 class="step-title">Ton entreprise a-t-elle un site web ?</h2>
                <input type="url" name="site_entreprise" class="input-field"
                    placeholder="https://www.ton-site.com (facultatif)">
            </div>

            <!-- √âtape 5 -->
            <div class="step" id="step-5" style="display: none;">
                <h2 class="step-title">Que fait ton entreprise ?</h2>
                <textarea name="activite_entreprise" class="input-field"
                    placeholder="D√©cris ton activit√© en une phrase"></textarea>
            </div>

            <!-- √âtape 6 -->
            <div class="step" id="step-6" style="display: none;">
                <h2 class="step-title">Quel est l‚Äôobjectif de ta demande ?</h2>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="objectif" value="Mod√®le 3D pour e-commerce">Mod√®le 3D pour
                        e-commerce</label>
                    <label><input type="checkbox" name="objectif" value="Visuels produit">Visuels pour produit</label>
                    <label><input type="checkbox" name="objectif" value="Animation produit">Animation produit</label>
                    <label><input type="checkbox" name="objectif" value="D√©monstration technique">D√©monstration
                        technique</label>
                    <label><input type="checkbox" name="objectif" value="R√©alit√© augment√©e">R√©alit√© augment√©e</label>
                </div>
            </div>

            <!-- √âtape 7 -->
            <div class="step" id="step-7" style="display: none;">
                <h2 class="step-title">√Ä quel stade en es-tu ?</h2>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="stade" value="Id√©e g√©n√©rale">Id√©e g√©n√©rale</label>
                    <label><input type="checkbox" name="stade" value="En d√©veloppement">Produit en d√©veloppement</label>
                    <label><input type="checkbox" name="stade" value="Pr√™t √† mod√©liser">Produit pr√™t √† mod√©liser</label>
                </div>
            </div>

            <!-- √âtape 8 -->
            <div class="step" id="step-8" style="display: none;">
                <h2 class="step-title">Quel est le produit √† mod√©liser ?</h2>
                <textarea name="produit_description" class="input-field"
                    placeholder="Nom, usage, dimensions, mati√®res..."></textarea>
            </div>

            <!-- √âtape 9 -->
            <div class="step" id="step-9" style="display: none;">
                <h2 class="step-title">Souhaites-tu des variantes ? (couleurs, textures, tailles...)</h2>
                <textarea name="variantes" class="input-field"
                    placeholder="Ex : 3 coloris, 2 textures... ou indique 'non'"></textarea>
            </div>

            <!-- √âtape 10 -->
            <div class="step" id="step-10" style="display: none;">
                <h2 class="step-title">As-tu des √©l√©ments √† nous transmettre pour mod√©liser ton produit ?</h2>
                <textarea name="elements_a_transmettre" class="input-field"
                    placeholder="Ex : croquis c√¥t√©, fichier 3D, charte graphique, dossier Drive, etc."></textarea>
                <input type="hidden" role="uploadcare-uploader" name="assets_model" data-multiple data-crop="free"
                    data-images-only />
            </div>

            <!-- √âtape 11 -->
            <div class="step" id="step-11" style="display: none;">
                <h2 class="step-title">Souhaites-tu une animation ?</h2>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="animation" value="Non">Non</label>
                    <label><input type="checkbox" name="animation" value="Oui">Oui</label>
                </div>
            </div>

            <!-- √âtape 12 -->
            <div class="step" id="step-12" style="display: none;">
                <h2 class="step-title">Si oui, quelle dur√©e doit-elle faire ?</h2>
                <input type="text" name="duree_animation" class="input-field" placeholder="Ex : 10 sec, 30 sec, etc.">
            </div>

            <!-- √âtape 13 -->
            <div class="step" id="step-13" style="display: none;">
                <h2 class="step-title">Souhaites-tu ajouter du son ou une musique ?</h2>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="animation_son" value="Non">Non</label>
                    <label><input type="checkbox" name="animation_son" value="Oui, j‚Äôai une piste">Oui, j‚Äôai une
                        piste</label>
                    <label><input type="checkbox" name="animation_son" value="Oui, je veux que Nexmod choisisse">Oui, je
                        veux que Nexmod choisisse</label>
                </div>
                <input type="hidden" role="uploadcare-uploader" name="fichier_animation" data-multiple
                    data-crop="free" />
            </div>

            <!-- √âtape 14 -->
            <div class="step" id="step-14" style="display: none;">
                <h2 class="step-title">Souhaites-tu que Nexmod int√®gre le mod√®le sur ton site ?</h2>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="integration" value="Non">Non, je souhaite uniquement les
                        fichiers</label>
                    <label><input type="checkbox" name="integration" value="Oui">Oui, je veux que Nexmod int√®gre le
                        mod√®le (ModelViewer, AR)</label>
                </div>
            </div>

            <!-- √âtape 15 -->
            <div class="step" id="step-15" style="display: none;">
                <h2 class="step-title">As-tu une deadline ?</h2>
                <input type="text" name="deadline" class="input-field" placeholder="Date ou d√©lai souhait√©">
            </div>

            <!-- √âtape 16 -->
            <div class="step" id="step-16" style="display: none;">
                <h2 class="step-title">As-tu un budget estim√© ?</h2>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="budget" value="500‚Ç¨">Moins de 500 ‚Ç¨</label>
                    <label><input type="checkbox" name="budget" value="500‚Äì1000‚Ç¨">500 ‚Äì 1000 ‚Ç¨</label>
                    <label><input type="checkbox" name="budget" value="1000‚Äì2000‚Ç¨">1000 ‚Äì 2000 ‚Ç¨</label>
                    <label><input type="checkbox" name="budget" value="2000‚Äì5000‚Ç¨">2000 ‚Äì 5000 ‚Ç¨</label>
                    <label><input type="checkbox" name="budget" value=">5000‚Ç¨+">Plus de 5000 ‚Ç¨</label>
                </div>
            </div>

            <!-- √âtape 17 -->
            <div class="step" id="step-17" style="display: none;">
                <h2 class="step-title">Comment as-tu connu Nexmod ?</h2>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="origine" value="Google">Google</label>
                    <label><input type="checkbox" name="origine" value="R√©seaux sociaux">R√©seaux sociaux</label>
                    <label><input type="checkbox" name="origine" value="Recommandation">Recommandation</label>
                    <label><input type="checkbox" name="origine" value="Autre">Autre</label>
                </div>
            </div>

            <!-- √âtape 18 -->
            <div class="step message-final" id="step-18" style="display: none;">
                <p class="message-final-text">
                    Merci <strong><span id="prenom-utilisateur">√† toi</span></strong> üôè<br>
                    Nous reviendrons vers toi sous 24h avec une proposition personnalis√©e.
                </p>
            </div>

            <!-- Les autres √©tapes (2 √† 14) restent identiques : copie/colle celles de ton code original -->
            <!-- ... -->
            <button type="button" class="form-btn" onclick="nextStep(); return false;">
                <img src="https://cdn.prod.website-files.com/67d404ef725b4244f4b32ad1/6804f359eab9bf4963c33c15_1646214.svg"
                    alt="Fl√®che suivante" class="arrow-icon" />
            </button>
        </form>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // Variables globales
            const isDesktop = window.innerWidth > 1024;
            const wrapper = document.querySelector(".video-wrapper");
            const playButton = document.getElementById("play-button");
            const steps = document.querySelectorAll(".step");
            const nextButton = document.querySelector(".form-btn");
            const progressBar = document.getElementById("progress-bar-devis");
            let currentStep = 0;
            let firstPlayFlags = []; // pour chaque vid√©o, on rewind+unmute qu‚Äôune seule fois

            function bindClickHandlerTo(video) {
                video.addEventListener('click', (event) => {
                    event.stopPropagation();          // ‚Üê emp√™che le wrapper de recevoir le m√™me clic
                    handleVideoClick(video);
                });
            }
            function handleVideoClick(vid) {
                const vids = document.querySelectorAll(".video");
                const index = Array.from(vids).indexOf(vid);
                const isFirstPlay = firstPlayFlags[index];

                console.log(`üñ±Ô∏è Click sur la vid√©o ${index}`);
                console.log(`   - firstPlayFlags[${index}] =`, isFirstPlay);
                console.log(`   - vid.paused =`, vid.paused);
                console.log(`   - vid.ended =`, vid.ended);

                if (isFirstPlay) {
                    console.log("   ‚ñ∂Ô∏è Premi√®re lecture (firstPlay = true)");
                    vid.currentTime = 0;
                    vid.muted = false;
                    firstPlayFlags[index] = false;
                    playButton.style.display = 'none';
                    vid.play();
                    return;
                }

                if (vid.ended) {
                    console.log("   ‚õî La vid√©o est termin√©e ‚Üí on ne fait rien.");
                    return;
                }

                if (vid.paused) {
                    console.log("   ‚ñ∂Ô∏è Reprise de la lecture");
                    vid.play();
                    playButton.style.display = 'none';
                } else {
                    console.log("   ‚è∏ Mise en pause");
                    vid.pause();
                    playButton.style.display = 'flex';
                }
            }





            // 1) Cr√©e les <video> sans autoplay
            function loadVideos() {
                const sources = [
                    "Download.mp4",
                    "Download.mp4",
                    "Download.mp4",
                    "Download.mp4",
                    "Download.mp4",
                    "Download.mp4",
                    // ajoute ici toutes tes vid√©os
                ];



                sources.forEach((src, index) => {
                    const video = document.createElement("video");
                    video.classList.add("video");

                    const source = document.createElement("source");
                    source.src = src;
                    source.type = "video/mp4";
                    video.appendChild(source);

                    wrapper.appendChild(video);

                    // Tr√®s important : on initialise chaque flag dans le bon ordre
                    firstPlayFlags[index] = (index === 0);
                });
                console.log("üöÄ Vid√©os charg√©es :", firstPlayFlags);
            }


            // 2) Active la vid√©o d‚Äôindex donn√© et lui applique loop/muted selon index
            function setupVideo(index) {
                console.log(`üé• Activation de la vid√©o ${index}`, {
                    firstPlay: firstPlayFlags[index],
                    firstPlayFlags: [...firstPlayFlags],
                });

                // RESET
                document.querySelectorAll('.video').forEach(v => {
                    v.pause();
                    v.classList.remove('active');
                    v.loop = false;
                    v.muted = false;
                    v.onclick = null;
                    v.onended = null;
                });

                const vid = document.querySelectorAll('.video')[index];

                if (!vid) return;
                vid.classList.add('active');

                // Sp√©cial premi√®re vid√©o
                firstPlay = (index === 0);

                if (index === 0) {
                    vid.loop = true;
                    vid.muted = true;
                    playButton.style.display = 'flex';
                } else {
                    // Vid√©os suivantes
                    vid.loop = false;
                    vid.muted = false;
                    playButton.style.display = 'none';

                    // Quand elles se terminent, on laisse l‚Äôoverlay visible,
                    // mais **on ne relance pas** au clic si ended===true** 
                    vid.onended = () => {
                        playButton.style.display = 'flex';
                    };
                }

                vid.play();
                const seekbarFill = document.getElementById("video-seekbar-fill");
                vid.addEventListener("timeupdate", () => {
                    if (vid.duration) {
                        const progress = (vid.currentTime / vid.duration) * 100;
                        seekbarFill.style.width = progress + "%";
                    }
                });
                const seekbar = document.getElementById("video-seekbar");
                seekbar.onclick = (e) => {
                    const rect = seekbar.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const pct = x / rect.width;
                    if (vid.duration) {
                        vid.currentTime = pct * vid.duration;
                        seekbarFill.style.width = (pct * 100) + "%";
                    }
                };

                bindClickHandlerTo(vid);
            }




            // 3) Clique unique sur toute la zone vid√©o (wrapper) pour play/pause
            // Clic direct sur la vid√©o (d√©j√† g√©r√© par setupVideo)
            // Clic sur l'overlay
            playButton.addEventListener("click", (e) => {
                e.stopPropagation(); // √©vite la propagation vers des parents
                const vid = document.querySelector(".video.active");
                if (vid) handleVideoClick(vid);
            });

            // 4) Navigation des √©tapes
            function focusFirst() {
                const first = steps[currentStep].querySelector(
                    "textarea, input[type='text'], input[type='email'], input[type='url'], input[type='number']"
                );
                if (first) first.focus({ preventScroll: true });
            }
            function updateButton() {
                const inputs = steps[currentStep].querySelectorAll("textarea, input");
                let valid = false;
                inputs.forEach(i => {
                    if (i.type === "checkbox" && i.checked) valid = true;
                    else if (["text", "email", "url", "number"].includes(i.type) && i.value.trim() !== "") valid = true;
                    else if (i.tagName === "TEXTAREA" && i.value.trim() !== "") valid = true;
                });
                nextButton.classList.toggle("active", valid);
            }
            function attachInputListeners() {
                steps.forEach(step => {
                    step.querySelectorAll("textarea, input").forEach(field => {
                        field.addEventListener("input", updateButton);
                        field.addEventListener("change", updateButton);
                    });
                });
            }
            let skipAnimationSteps = false;

            function getCheckboxValue(stepElement, name) {
                const inputs = stepElement.querySelectorAll(`input[name='${name}']`);
                for (const input of inputs) {
                    if (input.checked) return input.value;
                }
                return null;
            }


            window.nextStep = () => {
                // 1. Ne rien faire si le bouton n'est pas actif
                if (!nextButton.classList.contains("active")) return;

                const currStepEl = steps[currentStep];
                currStepEl.classList.add("fade-out");

                setTimeout(() => {
                    // 2. Cacher la step courante
                    currStepEl.style.display = "none";
                    currStepEl.classList.remove("fade-out");

                    // 3. Si on vient de l'√©tape 11 (index 10), g√©rer le skip des 12 & 13
                    if (currentStep === 10) {
                        const animValue = getCheckboxValue(currStepEl, "animation");
                        skipAnimationSteps = (animValue === "Non");
                    }

                    // 4. Calculer l'index de la prochaine √©tape
                    // 4. Calculer l'index de la prochaine √©tape
                    let nextIdx = currentStep + 1;
                    while (
                        skipAnimationSteps &&
                        (nextIdx === 11 || nextIdx === 12) &&
                        nextIdx < steps.length
                    ) {
                        nextIdx++;
                    }
                    currentStep = nextIdx;


                    // 5. Mettre √† jour la barre de progression
                    const pct = Math.min((currentStep / (steps.length - 1)) * 100, 100);
                    progressBar.style.width = pct + "%";

                    // 6. Si on arrive au dernier index (= √©tape 18 / message final)
                    if (currentStep === steps.length - 1) {
                        console.log("üöÄ √âtape 17 atteinte ‚Üí soumission + affichage √©tape 18");

                        // ‚Ä¢ Soumettre le formulaire
                        const form = document.getElementById("mon-formulaire");
                        if (form) form.submit();

                        // ‚Ä¢ Afficher le message final
                        setTimeout(() => {
                            steps.forEach(s => (s.style.display = "none"));
                            const finalStep = document.getElementById("step-18");
                            if (finalStep) finalStep.style.display = "flex";

                            // ‚Ä¢ Cacher le bouton
                            nextButton.style.display = "none";
                        }, 300);

                        return; // on sort, pas de navigation classique
                    }

                    // 7. Sinon, afficher la step suivante normalement
                    const nextEl = steps[currentStep];
                    nextEl.style.display = "flex";
                    nextEl.classList.add("fade-in");
                    setTimeout(() => nextEl.classList.remove("fade-in"), 400);

                    if (isDesktop) setupVideo(currentStep);
                    focusFirst();
                    updateButton();
                }, 400);
            };



            // === Initialisation ===
            loadVideos();
            setupVideo(0);
            wrapper.addEventListener('click', (e) => {
                const vid = document.querySelector('.video.active');
                if (!vid) return;

                const vids = document.querySelectorAll('.video');
                const index = Array.from(vids).indexOf(vid);

                // Ne rien faire si clic sur bouton play (il a son propre handler)
                if (e.target.closest('#play-button')) {
                    e.stopPropagation();
                    return;
                }

                // ‚ùóÔ∏è Ne rien faire si clic sur la seekbar
                if (e.target.closest('#video-seekbar')) {
                    e.stopPropagation();
                    return;
                }

                // Si premi√®re vid√©o : on veut autoriser clic n'importe o√π (m√™me sur .video)
                if (index === 0) {
                    handleVideoClick(vid);
                    return;
                }

                // Pour les vid√©os suivantes : ignorer le clic direct sur .video (g√©r√© par leur .onclick)
                if (e.target.classList.contains('video')) return;

                // Sinon (clic sur wrapper en dehors de la vid√©o) ‚Üí toggle pause/lecture
                handleVideoClick(vid);
            });



            // (la suite¬†: attachInputListeners(), updateButton(), focusFirst()‚Ä¶)
            attachInputListeners();
            updateButton();
            focusFirst();
        });

    </script>

</body>

</html>
